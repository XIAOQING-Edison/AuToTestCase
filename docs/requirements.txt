【PRD】营销活动优化（二期）-v1.0










1.文档概述




1.1 文档修订记录




日期






文档版本






状态






修订内容简述






修订人






批准人






2025-03-12














A






新增






刘春妍






































*状态：A--新增，M--修改，D--删除；








1.2 文档评审记录




评审类型






评审人






角色






评审意见






评审状态






评审日期






备注














刘春妍






产品






待评审






P
















































评审状态：P--待评审、A--评审通过、R--驳回；








1.3 版本计划




版本号






版本规划






修订时间






撰写人






预计上线时间






实际上线时间






V1.0






支持现有的活动类型，配置活动优先级和是否可叠加规则；

创建促销活动时，支持同商品重复活动提醒；

优化收银台活动交互和计算逻辑优化，能手工调整商品参与的活动；








2025-03-18






刘春妍



















































2.产品概述




2.1 背景目标




背景：



随着公司营销活动数量的增加，活动玩法复杂化，现有的活动模块难以满足灵活的业务场景需求，导致总部和门店人员的操作繁琐，缺乏清晰的活动规则和执行流程，影响了效率并增加了成本。本次迭代是通过优化活动模块的设计，提高活动规则透明度、减少维护成本、提高执行效率，并确保营销活动能够高效、清晰、精准地执行，以支持SaaS产品的推广并优化客户体验。



优化目标



构建五维度活动体系（单品/条件/整单/赠品/加购），活动计算规则透明化，使商品运营专员和门店员工都能很容易理解；

实现动态优先级策略，支持运营人员灵活配置，明确活动商品的优先级，避免规则冲突，并自动计算顾客可享受的最佳优惠；

建立规则引擎，支持跨维度叠加与互斥控制（如满减条件与折扣互斥检测）；

提供收银台活动可视化交互，支持系统自动优先推荐与人工干预双模式；

内置利润保护机制，商品活动设置重复时，弹窗提示运营人员确认，促销后毛利测算缺失，出现负利润活动；










2.2 业务范围




活动范围：系统现有营销活动类型



项目范围：通用需求，所有项目通用；三个云；








2.3 规则说明




2.3.1  活动维度定义




维度






类型示例






优先级规则






叠加控制






单品维度






特价、折扣、N+M特价Y






按商品级优先级排序






同商品仅生效1个活动






条件维度






满X元减Y、任选满Z件






条件满足度降序（满300＞满200）






互斥条件自动屏蔽






整单维度






全场满减、阶梯折扣






按订单金额占比加权






默认可与其他类型叠加






赠品维度






赠品券、联合赠品






按赠送门槛倒序






允许无限叠加






加购维度






换购、加价购






固定最低优先级






独立计算不冲突


































2.3.2  活动维度划分




活动条件






优惠方式






促销大类














买满（元）






立減（元）






条件














折扣（折）






条件














送赠品（件）






赠品






条件






整单买满X（元）加价购加价购






加价购






条件






买满（件）






整单买满X（件）加价购






加价购






条件






单品买满X（件）加价购






加价购






条件






任选（件）






特价（元）






条件














減（件）






条件














立減（元）






条件














折扣（折）






条件














送赠品（件）






赠品






条件






整单（折）






折扣（折）






整单














指定






折扣（折）






单品














特价（元）






单品














组合特价（元）






单品






组合






自定义（折）






从低到高（折）






条件














从高到低（折）






条件




































































































2.3.3  叠加互斥规则矩阵




当前活动\已应用






单品






条件






整单






赠品






加购






单品






×






△






√






√






√






条件






△






×






√






√






√






整单






√






√






×






√






√






赠品






√






√






√






×






√






加购






√






√






√






√






×






































其中：√:允许叠加       ×:互斥        △:条件冲突检测（如满减条件互斥）



冲突检测引擎增强
• 条件表达式冲突：检测互斥条件（如「满3件」与「满200元」）
• 资源占用冲突：实时校验赠品库存、加购商品库存池
• 预算冲突预警：跨维度共享预算池时触发熔断机制（后续实现）










概括而言：



同一促销大类间的共享互斥关系：
单品、条件、整单、买赠、加价购 促销：这五类同促销大类分组内互斥不可以叠加共享。

其中，单品中特殊的组合促销：按件计算组合的叠加；（如：2A+B+3C为一个组合，1A+1B为一个组合，用户购买了5A、3B、7C，则命中3个组合2*（2A+B+3C）+（1A+1B），额外还有1C）





不同促销大类间的共享互斥关系：
单品、条件、买赠、加价购 促销，不同促销大类之间可以配置共享互斥关系。以上不同促销类型之间不存在逻辑冲突且符合运营场景，所以不同大类之间支持共享，比如A商品享参与条件折扣依然可以参与满赠。

组合促销，不可与单品、买赠、条件促销叠加共享，但默认可与整单促销共享；

整单促销，默认可与单品（组合）、条件、买赠、加价购促销叠加共享；







最终结论总结如下：



不同促销大类叠加规则














单品






条件






买赠






加价购






整单






单品






互斥






配置






配置






配置






可叠加






条件






配置






互斥






配置






配置






可叠加






买赠






配置






配置






互斥






配置






可叠加






加价购






配置






配置






配置






互斥






可叠加






整单






可叠加






可叠加






可叠加






可叠加






互斥













































2.3.4  同促销大类命中规则




同促销大类下多个促销活动间的命中规则






活动维度






计算逻辑（优先级）






单品(组合)促销






单品促销、条件促销、整单促销、买赠促销、加价购 同促销大类下的促销活动不可叠加；

同促销大类下子促销类型计算规则：
单品促销的命中逻辑：
多个单品促销，优先命中优先级最高的；

同优先级，会进行比价命中价格最优惠的；

同优惠力度，优先命中包含当前店且门店范围最少的；

门店范围相同，取最新创建的促销；
eg：单品：SKUA原价50元，活动A01 07月15日创建特价40元；同时活动A02打9折。那么命中促销时进行比价，特价40,9折45；最终命中特价；注：单品价还要结合会员价、档期价等价格因素进行统一算价。

组合促销：按件计算组合的叠加；eg: 如SKUA和B、A和C都有组合商品，则购买3件A、2件B、1件C，则可命中3组组合（A+B、A+B、A+C）；





条件促销、整单促销、买赠促销、加价购的命中逻辑
同类下多个促销，优先命中优先级最高的；

同优先级，优先命中优惠门槛（如有）最高的；

门槛相同，优先命中包含当前店且门店范围最少的；

门店范围相同，取最新创建的促销；
eg：SKUA同时参加满减（6月2日配置）和加价购（6月1日配置），满减活动为最新创建，则命中满减；












条件促销






整单促销






买赠促销






加价购促销
































优先级判定规则



Plain text
ANTLR4
Bash
C
C#
CSS
CoffeeScript
CMake
Dart
Django
Docker
EJS
Erlang
Git
Go
GraphQL
Groovy
HTML
Java
JavaScript
JSON
JSX
Kotlin
LaTeX
Less
Lua
Makefile
Markdown
MATLAB
Markup
Objective-C
Perl
PHP
PowerShell
.properties
Protocol Buffers
Python
R
Ruby
Sass (Sass)
Sass (Scss)
Scheme
SQL
Shell
Swift
SVG
TSX
TypeScript
WebAssembly
YAML
XML

自动换行



if 活动类别优先级不同 ➔ 取优先级高的活动  
else if 优惠金额不同 ➔ 取优惠金额高的活动   
else if 门店范围不同 ➔ 部分门店 > 全部门店  
else ➔ 取最新创建的活动  




if 活动类别优先级不同 ➔ 取优先级高的活动  
else if 活动门槛不同 ➔ 取门槛金额高的活动   
else if 门店范围不同 ➔ 部分门店 > 全部门店  
else ➔ 取最新创建的活动  











2.3.5  优惠金额分摊规则




活动匹配流程



Plain text
ANTLR4
Bash
C
C#
CSS
CoffeeScript
CMake
Dart
Django
Docker
EJS
Erlang
Git
Go
GraphQL
Groovy
HTML
Java
JavaScript
JSON
JSX
Kotlin
LaTeX
Less
Lua
Makefile
Markdown
MATLAB
Markup
Objective-C
Perl
PHP
PowerShell
.properties
Protocol Buffers
Python
R
Ruby
Sass (Sass)
Sass (Scss)
Scheme
SQL
Shell
Swift
SVG
TSX
TypeScript
WebAssembly
YAML
XML

自动换行



1.输入商品清单、门店ID、会员等级
2.筛选符合基础条件的活动池按优先级要素排序：
  a.活动等级升序排列
  b.活动优惠金额或活动门槛倒序；
  c.门店范围系数升序排列
  d.创建时间倒序排列
3. 应用叠加规则校验：
  维度冲突检测
  最大层数校验
4. 输出最优活动组合方案






价格计算模型：



Plain text
ANTLR4
Bash
C
C#
CSS
CoffeeScript
CMake
Dart
Django
Docker
EJS
Erlang
Git
Go
GraphQL
Groovy
HTML
Java
JavaScript
JSON
JSX
Kotlin
LaTeX
Less
Lua
Makefile
Markdown
MATLAB
Markup
Objective-C
Perl
PHP
PowerShell
.properties
Protocol Buffers
Python
R
Ruby
Sass (Sass)
Sass (Scss)
Scheme
SQL
Shell
Swift
SVG
TSX
TypeScript
WebAssembly
YAML
XML

自动换行



最终价格 = MIN(
  单品活动价, 
  整单活动价 × (1 - 叠加折扣), 
  基础价 × (1 - MAX(折扣活动)) 
) + 加购附加费






分层计算流水线：



单品维度→2. 条件维度→3. 整单维度→4. 赠品维度→5. 加购维度





 优惠分摊算法：



Plain text
ANTLR4
Bash
C
C#
CSS
CoffeeScript
CMake
Dart
Django
Docker
EJS
Erlang
Git
Go
GraphQL
Groovy
HTML
Java
JavaScript
JSON
JSX
Kotlin
LaTeX
Less
Lua
Makefile
Markdown
MATLAB
Markup
Objective-C
Perl
PHP
PowerShell
.properties
Protocol Buffers
Python
R
Ruby
Sass (Sass)
Sass (Scss)
Scheme
SQL
Shell
Swift
SVG
TSX
TypeScript
WebAssembly
YAML
XML

自动换行



单品分摊金额 = (单品原价/订单总原价) × 总优惠金额  
整单分摊金额 = 订单总优惠 - ∑单品分摊  






计算方式：递进式促销













需确保订单财务核算与售后退款精准。








2.4 功能清单




应用端






一级功能






二级功能






功能点






需求描述














管理后台






营销中心






创建/编辑促销活动






活动优先级配置






















活动互斥叠加配置






















活动提交重复提示






















收银台






收银界面






购物车






扫码自动命中单品/条件促销






购物车扫码时，自动命中最优单品、条件促销，订单提交时计算整单促销、买赠、加价购














切换商品促销






支持商品维度切换促销活动














营销活动






营销活动计算






调整营销活动计算算法，根据最新规则计算活动命中














自助收银






收银界面






营销活动






扫码自动命中单品/条件促销






购物车扫码时，自动命中最优单品、条件促销，订单提交时计算整单促销、买赠、加价购









































































































3.需求说明




应用端






功能点






原型






需求说明






备注






管理后台






促销活动-创建/编辑活动-活动叠加规则配置




















如原型所示：
在促销门槛及规则后，标签形式展示促销大类；

优先级：配置当前促销活动在同促销大类下的优先级，默认“普通”，允许设置高或低优先级；

增加【叠加规则】：
与优惠券叠加：勾选后，该营销活动可与优惠券叠加；（最终是否叠加还需判断电商优惠券配置条件）

单品促销：【可与条件促销叠加】、【可与买赠促销叠加】、【可与加价购促销叠加】，默认都是非选中状态；

条件促销：【可与单品促销叠加】、【可与买赠促销叠加】、【可与加价购促销叠加】，默认都是非选中状态；

买赠促销：【可与单品促销叠加】、【可与条件促销叠加】、【可与加价购促销叠加】，默认都是非选中状态；

加价购促销：【可与单品促销叠加】、【可与条件促销叠加】、【可与买赠促销叠加】，默认都是非选中状态；




















活动重复校验提示


































单品维度校验：
冲突条件：同一商品在重叠时间段内存在≥2个单品促销（如特价+折扣）；

校验逻辑：计算重叠时段内促销力度差值：Δ=现活动优惠价/原活动优惠价Δ≥15%时触发强提醒（红色预警），Δ<15%时触发弱提醒（黄色提示）；

提示文案：【单品促销】时段重叠（2025/03/01-2025/03/31）；优惠力度大于当前活动（7折）；优先级低于当前活动（默认）；



条件维度校验：
冲突条件：同一商品同时参与≥2个 买满/任选类活动且门槛重叠（如满100-20与满100-30；任选3件减1件与任选3件7折）；

校验逻辑：【条件促销】计算时段重叠（2025/03/01-2025/03/31）；优惠门槛；



整单维度校验：
冲突条件：整单折扣与其他整单折扣时间交叉；



赠品维度校验：
冲突条件：同一商品作为主品关联≥2个赠品活动且时间交叉；



加价购维度校验：
冲突条件：同一商品存在多个加价购规则且时间交叉；






促销活动重复提示：
提示确认触发条件：
触发操作：
创建/编辑促销活动，点击提交活动时；

促销调整单-按商品追加促销活动时；




触发条件：当活动中所选商品存在时间门店重叠的生效中的其他活动时；

触发活动类型：所有类型活动，只按商品门店时间维度校验去重，如创建单品折扣，校验商品存在买赠、特价、满减活动都需提示；




界面交互：
列表：商品编码、商品条码、商品名称、活动编码、活动名称、促销类型、适用门店、活动状态、创建人、创建时间、审核人、审核时间 ；

数据筛选：去重提示仅查询待开始、进行中的有效活动，不包含已结束、已作废；

数据排序：按商品编码、条码、重复活动编码正序排列；




交互说明：
默认勾选所有列表数据，表示存在冲突仍需继续创建；

若取消勾选，即商品不进入活动商品清单；（同一商品存在多个促销活动，即列表有多条重复数据时，勾选单个商品条码，该商品对应其他促销默认也取消勾选，即将商品从新建的促销活动剔除）

点击【确认】提交活动商品范围中将取消勾选的商品删除并提交活动，提示创建成功并返回列表；

点击【取消】关闭确认弹窗，停留在创建/编辑活动页；




导出活动重复提示列表：
支持点击Excel下载促销活动重复提示列表所有数据；

点击下载导出模板同列表字段；






















收银台






购物车




















扫码加购匹配促销活动：
优先匹配单品促销中最优惠的促销活动；

无单品促销，存在条件促销时，命中最优惠条件促销；

换购、买赠：扫码后展示对应活动标签，未添加赠品/换购品则在提交活动时弹窗提示换购/添加赠品；


























单品-换促销
































入口：在单品维度，改价下方展示【换促销】；

展示条件：当前商品有且促销活动数≥2；

可换促销：门店单品满足门槛可参与的生效中促销活动；

交互：更换后，返回购物车，购物车重新按活动标签分组，展示最新内容；
























订单优惠




















订单优惠明细：
按促销大类展示优惠金额；

仅展示订单已参与的优惠明细，订单不涉及优惠不展示；
























整单活动




















按购物车已命中的单品、用户所选条件/买赠/加价购促销，及自动命中的整单促销，计算出最优活动方案，默认选中最优方案；

支持切换其他促销方案，切换后购物车活动标签分组根据所选活动结果展示；
























选择赠品




















购物车中，支持按活动标签维度选择可领取赠品，也可最终在订单提交前一次领取；
























换购商品




















购物车中，支持按活动标签维度选择换购商品，也可最终在订单提交前一次换购；
















自助收银






购物车




















单品促销：扫码后展示活动类型标签；

条件促销：
未满足条件时，扫码展示可参与活动标签；

已满足条件时，同单品促销展示样式，展示优惠方式【特价】【折扣】【满减】；



买赠促销：扫码后满足条件，购物车展示买赠标题，支持购物车选择赠品、扫码录入赠品；

换购促销：扫码后满足条件，购物车展示换购标题，支持购物车跳转选择换购商品、扫码录入换购商品；





































































































4.非功能性需求




性能并发指标；

操作日志：记录订单推荐、人工干预、规则生效记录；















评审Q&A




会议结论：
活动优先级：活动列表建议增加筛选；

优先级作用范围：同大类内调整促销优先级，不支持跨促销大类调整优先级；

叠加规则：去掉优惠券叠加配置，优惠券与活动叠加与否保留在电商控制逻辑；

活动重复提示：
筛选：活动表头加商品条码、活动编码名称等筛选；

列表：默认参与，勾选批量删除；勾选单商品条码后删除后，会将该商品从新创建活动列表移除（即同商品多活动只需勾选一次）；

重复提示交互：异步任务的形式提示，创建/促销追加时可直接保存成功，活动重复冲突校验完毕标识提醒用户核查下载；



收银台：
单商品换促销：去掉，不支持店员切换单品促销活动；

收银台交互：
单品促销：扫描商品条码，加购成功即展示命中的最优惠单品活动、活动类型标签、活动价；

其他促销：在商品录入结束，选择营销活动或订单结账前，按现有选方案方式统一选择最优促销方案，选中促销方案返回购物车后，按活动标签分组展示商品；

客显信息：保持现状，不需展示活动标签分组等信息；





赠品/加价购：不在购物车展示赠品/加价购商品，因为需结账时店员协助取赠品或换购，统一在订单提交时完成；

自助收银：优化优惠明细查看入口；

极简版收银台：本期活动迭代不需改造；因计划5月份前完成触屏版切换，后续活动改造仅维护触屏版收银台；

连带率促销：考虑到线下实际门店顾客结账场景，本期先不加连带促销推荐，有需要在后续版本单独迭代；

分工和排期：
分工：前端泳波、后端梓洋；

排期：待前后端输出技术方案后评估确认；@黄梓洋@陈泳波




https://shanhui.dingtalk.com/meeting/Mp7ld3z4rAeWMOBQ?utm_source=share_link#「KPOS营销活动优化二期需求评审」









附录：




1、活动优惠金额计算逻辑




促销活动优惠金额计算






促销大类






促销子类






优惠金额X






备注








单品促销






单品特价






X=单品零售价-单品特价金额














单品折扣






X=商品零售价*（1-折扣比例）














买赠促销






满赠/买赠促销






X=SUM(赠品零售价)
















条件促销-第N件






第N件特价






X=最低价商品零售价-特价金额














第N件折扣






X=最低价商品零售价*（1-折扣比例）






















条件促销-满N件










满N件特价






N件总价（N件M元）：X=SUM_N（商品零售价）-M；














每件单价：X=SUM（每件商品零售价-特价金额）；














指定件特价：X=SUM_M(最低M件零售价-特价金额)














满N件折扣






X=SUM(商品零售价)*（1-折扣比例）














满N件立减






X=立减金额














满N件免X件






X=SUM_X(最低价X件商品零售价)














满N件加价购






X=SUM（换购商品零售价-换购金额）


















条件促销-满金额








满额立减






满减：X=立减金额














阶梯满减：X=对应阶梯的立减金额














每满减：X=促销翻倍次数*立减金额














满额折扣






X=SUM（商品零售价）*（1-折扣比例）














满额赠送






X=SUM（赠品零售价）














满额加价购






X=SUM（换购商品零售价-换购金额）














组合促销






组合特价






X=SUM（组合内商品零售价）-特价金额
















整单促销






整单满额立减






X=整单立减金额














整单满额折扣






X=商品总金额*（1-折扣比例）














整单满额加价购






X=SUM（换购商品零售价-换购金额）



















































































2、原活动计算逻辑


















